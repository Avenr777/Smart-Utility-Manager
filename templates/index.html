{% extends 'base.html' %}
{% block title %}Dashboard — PulseIQ{% endblock %}

{% block content %}
<style>
  @keyframes ping {
    0% { transform: scale(1); opacity: 0.4; }
    100% { transform: scale(2.5); opacity: 0; }
  }
  .module-card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 16px;
    padding: 28px;
    transition: border-color 0.2s, transform 0.2s, box-shadow 0.2s;
    position: relative;
    overflow: hidden;
  }
  .module-card::before {
    content: '';
    position: absolute;
    top: 0; left: 0; right: 0;
    height: 1px;
    background: linear-gradient(90deg, transparent, var(--accent), transparent);
    opacity: 0;
    transition: opacity 0.3s;
  }
  .module-card:hover::before { opacity: 1; }
  .module-card:hover {
    border-color: rgba(99,102,241,0.4);
    transform: translateY(-3px);
    box-shadow: 0 20px 40px rgba(0,0,0,0.4), 0 0 0 1px rgba(99,102,241,0.1);
  }
  .alert-row { transition: background 0.15s; }
  .alert-row:hover { background: var(--elevated) !important; }
  .gauge-bar {
    height: 3px;
    background: var(--border);
    border-radius: 2px;
    overflow: hidden;
    margin-top: 8px;
  }
  .gauge-fill {
    height: 100%;
    border-radius: 2px;
    transition: width 1s ease;
  }
</style>

<div style="min-height: calc(100vh - 56px); padding: 32px 40px; max-width: 1300px; margin: 0 auto;">

  <!-- Header row -->
  <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 36px;">
    <div>
      <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 6px;">
        <p class="kpi-label" style="margin: 0;">PulseIQ · Campus Infrastructure</p>
        <div style="height: 1px; width: 40px; background: var(--border);"></div>
        <p class="kpi-label" style="margin: 0; color: var(--accent);">Live</p>
      </div>
      <h1 style="font-size: 28px; font-weight: 700; letter-spacing: -0.03em;">System Overview</h1>
    </div>
    <div style="display: flex; align-items: center; gap: 10px; padding: 10px 18px; border-radius: 10px; background: rgba(34,197,94,0.06); border: 1px solid rgba(34,197,94,0.15);">
      <span class="dot dot-normal"></span>
      <span style="font-size: 12px; color: var(--normal); font-weight: 600; letter-spacing: 0.06em; text-transform: uppercase;">All systems operational</span>
    </div>
  </div>

  <!-- KPI strip -->
  <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; margin-bottom: 28px;">

    <div style="background: var(--surface); border: 1px solid var(--border); border-radius: 12px; padding: 20px 22px; position: relative; overflow: hidden;">
      <div style="position: absolute; top: 0; right: 0; width: 80px; height: 80px; background: radial-gradient(circle, rgba(99,102,241,0.08) 0%, transparent 70%);"></div>
      <div class="kpi-label" style="margin-bottom: 8px;">Records processed</div>
      <div style="font-size: 28px; font-weight: 700; font-family: 'DM Mono', monospace; letter-spacing: -0.02em;">2.3M</div>
      <div class="kpi-sub" style="margin-top: 4px;">Jan – Jun 2024</div>
      <div class="gauge-bar"><div class="gauge-fill" style="width: 78%; background: var(--accent);"></div></div>
    </div>

    <div style="background: var(--surface); border: 1px solid var(--border); border-radius: 12px; padding: 20px 22px; position: relative; overflow: hidden;">
      <div style="position: absolute; top: 0; right: 0; width: 80px; height: 80px; background: radial-gradient(circle, rgba(34,197,94,0.08) 0%, transparent 70%);"></div>
      <div class="kpi-label" style="margin-bottom: 8px;">Assets monitored</div>
      <div style="font-size: 28px; font-weight: 700; font-family: 'DM Mono', monospace; letter-spacing: -0.02em;">9</div>
      <div class="kpi-sub" style="margin-top: 4px;">Electrical infrastructure</div>
      <div class="gauge-bar"><div class="gauge-fill" style="width: 90%; background: var(--normal);"></div></div>
    </div>

    <div style="background: var(--surface); border: 1px solid var(--border); border-radius: 12px; padding: 20px 22px; position: relative; overflow: hidden;">
      <div style="position: absolute; top: 0; right: 0; width: 80px; height: 80px; background: radial-gradient(circle, rgba(99,102,241,0.1) 0%, transparent 70%);"></div>
      <div class="kpi-label" style="margin-bottom: 8px;">Anomaly detection rate</div>
      <div style="font-size: 28px; font-weight: 700; font-family: 'DM Mono', monospace; letter-spacing: -0.02em; color: var(--accent);">6.2%</div>
      <div class="kpi-sub" style="margin-top: 4px;">145,970 flagged readings</div>
      <div class="gauge-bar"><div class="gauge-fill" style="width: 62%; background: var(--accent);"></div></div>
    </div>

    <div style="background: var(--surface); border: 1px solid rgba(239,68,68,0.2); border-radius: 12px; padding: 20px 22px; position: relative; overflow: hidden;">
      <div style="position: absolute; top: 0; right: 0; width: 80px; height: 80px; background: radial-gradient(circle, rgba(239,68,68,0.1) 0%, transparent 70%);"></div>
      <div class="kpi-label" style="margin-bottom: 8px;">Active alerts</div>
      <div style="font-size: 28px; font-weight: 700; font-family: 'DM Mono', monospace; letter-spacing: -0.02em; color: var(--failure);">2</div>
      <div class="kpi-sub" style="margin-top: 4px;">1 failure · 1 anomaly</div>
      <div class="gauge-bar"><div class="gauge-fill" style="width: 20%; background: var(--failure);"></div></div>
    </div>

  </div>

  <!-- Modules + Alerts grid -->
  <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 28px;">

    <!-- Electricity module -->
    <a href="{% url 'electricity' %}" style="text-decoration: none;">
      <div class="module-card">
        <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 20px;">
          <div style="display: flex; align-items: center; gap: 12px;">
            <div style="width: 42px; height: 42px; border-radius: 10px; background: rgba(99,102,241,0.12); border: 1px solid rgba(99,102,241,0.25); display: flex; align-items: center; justify-content: center;">
              <svg width="18" height="18" fill="none" stroke="var(--accent)" stroke-width="1.5" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M3.75 13.5l10.5-11.25L12 10.5h8.25L9.75 21.75 12 13.5H3.75z"/></svg>
            </div>
            <div>
              <div style="font-size: 20px; font-weight: 800; letter-spacing: -0.02em;">Electrical Module</div>
            </div>
          </div>
          <span class="badge badge-normal"><span class="dot dot-normal"></span>Live</span>
        </div>

        <p style="font-size: 13px; color: var(--muted); line-height: 1.7; margin-bottom: 22px;">
          Load monitoring, anomaly detection, cascade failure prediction, and energy waste analysis across 9 campus assets.
        </p>

        <!-- Mini heatmap bars -->
        <div style="display: flex; gap: 3px; margin-bottom: 22px; align-items: flex-end; height: 32px;">
          {% for h in "12345678901234567890123456" %}
          <div style="flex: 1; border-radius: 2px; background: rgba(99,102,241,0.{{ forloop.counter|add:'1' }});min-height:4px; height: {{ forloop.counter }}px; max-height: 32px;"></div>
          {% endfor %}
        </div>

        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px; padding-top: 18px; border-top: 1px solid var(--border);">
          <div>
            <div class="kpi-label" style="margin-bottom: 4px;">Assets</div>
            <div style="font-size: 22px; font-weight: 700; font-family: 'DM Mono', monospace;">9</div>
          </div>
          <div>
            <div class="kpi-label" style="margin-bottom: 4px;">Anomalies</div>
            <div style="font-size: 22px; font-weight: 700; font-family: 'DM Mono', monospace; color: var(--anomaly);">2</div>
          </div>
          <div>
            <div class="kpi-label" style="margin-bottom: 4px;">Risk score</div>
            <div style="font-size: 22px; font-weight: 700; font-family: 'DM Mono', monospace; color: var(--anomaly);">45<span style="font-size: 12px; color: var(--muted); font-weight: 400;">/100</span></div>
          </div>
        </div>
      </div>
    </a>

    <!-- Water module -->
    <a href="{% url 'water' %}" style="text-decoration: none;">
      <div class="module-card" style="opacity: 0.5;">
        <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 20px;">
          <div style="display: flex; align-items: center; gap: 12px;">
            <div style="width: 42px; height: 42px; border-radius: 10px; background: var(--elevated); border: 1px solid var(--border); display: flex; align-items: center; justify-content: center;">
              <svg width="18" height="18" fill="none" stroke="var(--muted)" stroke-width="1.5" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M12 3c-4.444 5.333-6.667 9.333-6.667 12a6.667 6.667 0 1013.334 0C18.667 12.333 16.444 8.333 12 3z"/></svg>
            </div>
            <div>
              <div style="font-size: 20px; font-weight: 800; letter-spacing: -0.02em;">Water Module</div>
            </div>
          </div>
          <span class="badge badge-accent">Coming soon</span>
        </div>
        <p style="font-size: 13px; color: var(--muted); line-height: 1.7; margin-bottom: 22px;">
          Flow analytics, pressure monitoring, pump health prediction, and leak detection. Launching after electrical module.
        </p>
        <div style="display: flex; gap: 3px; margin-bottom: 22px; align-items: flex-end; height: 32px;">
          {% for h in "12345678901234567890123456" %}
          <div style="flex: 1; border-radius: 2px; background: var(--border); min-height: 4px; height: {{ forloop.counter }}px; max-height: 32px;"></div>
          {% endfor %}
        </div>
        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px; padding-top: 18px; border-top: 1px solid var(--border);">
          <div><div class="kpi-label" style="margin-bottom: 4px;">Assets</div><div style="font-size: 22px; font-weight: 700; font-family: 'DM Mono', monospace; color: var(--muted);">—</div></div>
          <div><div class="kpi-label" style="margin-bottom: 4px;">Anomalies</div><div style="font-size: 22px; font-weight: 700; font-family: 'DM Mono', monospace; color: var(--muted);">—</div></div>
          <div><div class="kpi-label" style="margin-bottom: 4px;">Risk score</div><div style="font-size: 22px; font-weight: 700; font-family: 'DM Mono', monospace; color: var(--muted);">—</div></div>
        </div>
      </div>
    </a>

  </div>

  <!-- Recent alerts -->
  <div style="border: 1px solid var(--border); border-radius: 16px; overflow: hidden;">
    <div style="display: flex; justify-content: space-between; align-items: center; padding: 16px 24px; border-bottom: 1px solid var(--border); background: var(--surface);">
      <div style="display: flex; align-items: center; gap: 10px;">
        <p class="kpi-label" style="margin: 0;">Recent alerts</p>
        <div style="background: rgba(239,68,68,0.1); border: 1px solid rgba(239,68,68,0.2); border-radius: 20px; padding: 2px 10px; font-size: 11px; font-weight: 600; color: var(--failure);">2 active</div>
      </div>
      <a href="{% url 'electricity' %}#alerts" style="font-size: 12px; color: var(--accent); text-decoration: none; font-weight: 500;">View all →</a>
    </div>
    <table style="width: 100%; border-collapse: collapse; font-size: 13px;">
      <thead>
        <tr style="background: var(--elevated);">
          <th style="padding: 10px 24px; text-align: left; font-size: 10px; font-weight: 600; letter-spacing: 0.08em; text-transform: uppercase; color: var(--muted);">Asset</th>
          <th style="padding: 10px 24px; text-align: left; font-size: 10px; font-weight: 600; letter-spacing: 0.08em; text-transform: uppercase; color: var(--muted);">Status</th>
          <th style="padding: 10px 24px; text-align: left; font-size: 10px; font-weight: 600; letter-spacing: 0.08em; text-transform: uppercase; color: var(--muted);">Score</th>
          <th style="padding: 10px 24px; text-align: left; font-size: 10px; font-weight: 600; letter-spacing: 0.08em; text-transform: uppercase; color: var(--muted);">Module</th>
          <th style="padding: 10px 24px; text-align: left; font-size: 10px; font-weight: 600; letter-spacing: 0.08em; text-transform: uppercase; color: var(--muted);">Time</th>
        </tr>
      </thead>
      <tbody>
        <tr class="alert-row" style="border-top: 1px solid var(--border); background: rgba(239,68,68,0.03);">
          <td style="padding: 15px 24px; font-family: 'DM Mono', monospace; font-size: 12px; font-weight: 500;">transformer_block_a</td>
          <td style="padding: 15px 24px;"><span class="badge badge-failure"><span class="dot dot-failure"></span>Failure</span></td>
          <td style="padding: 15px 24px;">
            <div style="display: flex; align-items: center; gap: 10px;">
              <span style="font-family: 'DM Mono', monospace; color: var(--failure); font-weight: 600;">0.91</span>
              <div style="width: 60px; height: 4px; background: var(--border); border-radius: 2px; overflow: hidden;">
                <div style="width: 91%; height: 100%; background: var(--failure); border-radius: 2px;"></div>
              </div>
            </div>
          </td>
          <td style="padding: 15px 24px; color: var(--muted); font-size: 12px;">Electrical</td>
          <td style="padding: 15px 24px; color: var(--muted);">2 min ago</td>
        </tr>
        <tr class="alert-row" style="border-top: 1px solid var(--border); background: rgba(245,158,11,0.02);">
          <td style="padding: 15px 24px; font-family: 'DM Mono', monospace; font-size: 12px; font-weight: 500;">ac_unit_lab_1</td>
          <td style="padding: 15px 24px;"><span class="badge badge-anomaly"><span class="dot dot-anomaly"></span>Anomaly</span></td>
          <td style="padding: 15px 24px;">
            <div style="display: flex; align-items: center; gap: 10px;">
              <span style="font-family: 'DM Mono', monospace; color: var(--anomaly); font-weight: 600;">0.67</span>
              <div style="width: 60px; height: 4px; background: var(--border); border-radius: 2px; overflow: hidden;">
                <div style="width: 67%; height: 100%; background: var(--anomaly); border-radius: 2px;"></div>
              </div>
            </div>
          </td>
          <td style="padding: 15px 24px; color: var(--muted); font-size: 12px;">Electrical</td>
          <td style="padding: 15px 24px; color: var(--muted);">18 min ago</td>
        </tr>
        <tr class="alert-row" style="border-top: 1px solid var(--border);">
          <td style="padding: 15px 24px; font-family: 'DM Mono', monospace; font-size: 12px; font-weight: 500;">lab_db_floor1</td>
          <td style="padding: 15px 24px;"><span class="badge badge-normal"><span class="dot dot-normal"></span>Normal</span></td>
          <td style="padding: 15px 24px;">
            <div style="display: flex; align-items: center; gap: 10px;">
              <span style="font-family: 'DM Mono', monospace; color: var(--normal); font-weight: 600;">0.12</span>
              <div style="width: 60px; height: 4px; background: var(--border); border-radius: 2px; overflow: hidden;">
                <div style="width: 12%; height: 100%; background: var(--normal); border-radius: 2px;"></div>
              </div>
            </div>
          </td>
          <td style="padding: 15px 24px; color: var(--muted); font-size: 12px;">Electrical</td>
          <td style="padding: 15px 24px; color: var(--muted);">1 hr ago</td>
        </tr>
      </tbody>
    </table>
  </div>

</div>
{% endblock %}